syntax = "proto3";

package chat.v1;

option go_package = "github.com/titan-commerce/backend/chat-service/proto/chat/v1;chatv1";

import "google/protobuf/timestamp.proto";

service ChatService {
  rpc SendMessage(SendMessageRequest) returns (SendMessageResponse);
  rpc GetMessages(GetMessagesRequest) returns (GetMessagesResponse);
  rpc GetConversations(GetConversationsRequest) returns (GetConversationsResponse);
  rpc MarkAsRead(MarkAsReadRequest) returns (MarkAsReadResponse);
}

enum MessageType {
  MESSAGE_TYPE_UNSPECIFIED = 0;
  MESSAGE_TYPE_TEXT = 1;
  MESSAGE_TYPE_IMAGE = 2;
  MESSAGE_TYPE_VIDEO = 3;
  MESSAGE_TYPE_FILE = 4;
  MESSAGE_TYPE_PRODUCT_LINK = 5;
}

message Message {
  string message_id = 1;
  string conversation_id = 2;
  string sender_id = 3;
  string receiver_id = 4;
  MessageType type = 5;
  string content = 6;
  string media_url = 7;
  bool read = 8;
  google.protobuf.Timestamp created_at = 9;
}

message Conversation {
  string conversation_id = 1;
  repeated string participant_ids = 2;
  Message last_message = 3;
  int32 unread_count = 4;
  google.protobuf.Timestamp updated_at = 5;
}

message SendMessageRequest {
  string sender_id = 1;
  string receiver_id = 2;
  MessageType type = 3;
  string content = 4;
  string media_url = 5;
}

message SendMessageResponse {
  Message message = 1;
}

message GetMessagesRequest {
  string conversation_id = 1;
  int32 page_size = 2;
  int32 page = 3;
}

message GetMessagesResponse {
  repeated Message messages = 1;
  int32 total_count = 2;
}

message GetConversationsRequest {
  string user_id = 1;
  int32 page_size = 2;
}

message GetConversationsResponse {
  repeated Conversation conversations = 1;
}

message MarkAsReadRequest {
  string message_id = 1;
}

message MarkAsReadResponse {
  bool success = 1;
}
