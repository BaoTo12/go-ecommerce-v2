syntax = "proto3";

package tracking.v1;

option go_package = "github.com/titan-commerce/backend/tracking-service/proto/tracking/v1;trackingv1";

import "google/protobuf/timestamp.proto";

service TrackingService {
  rpc CreateTracking(CreateTrackingRequest) returns (CreateTrackingResponse);
  rpc UpdateLocation(UpdateLocationRequest) returns (UpdateLocationResponse);
  rpc GetTrackingHistory(GetTrackingHistoryRequest) returns (GetTrackingHistoryResponse);
  rpc SubscribeToUpdates(SubscribeToUpdatesRequest) returns (stream TrackingUpdate);
  rpc GetCurrentStatus(GetCurrentStatusRequest) returns (GetCurrentStatusResponse);
}

enum TrackingEventType {
  TRACKING_EVENT_TYPE_UNSPECIFIED = 0;
  TRACKING_EVENT_TYPE_PICKED_UP = 1;
  TRACKING_EVENT_TYPE_IN_TRANSIT = 2;
  TRACKING_EVENT_TYPE_AT_FACILITY = 3;
  TRACKING_EVENT_TYPE_OUT_FOR_DELIVERY = 4;
  TRACKING_EVENT_TYPE_DELIVERED = 5;
  TRACKING_EVENT_TYPE_EXCEPTION = 6;
  TRACKING_EVENT_TYPE_RETURNED = 7;
}

message Location {
  string city = 1;
  string state = 2;
  string country = 3;
  double latitude = 4;
  double longitude = 5;
}

message TrackingEvent {
  string event_id = 1;
  string tracking_number = 2;
  TrackingEventType event_type = 3;
  Location location = 4;
  string description = 5;
  google.protobuf.Timestamp timestamp = 6;
  string carrier = 7;
  string facility_name = 8;
}

message CreateTrackingRequest {
  string tracking_number = 1;
  string shipment_id = 2;
  string carrier = 3;
  string origin = 4;
  string destination = 5;
}

message CreateTrackingResponse {
  string tracking_number = 1;
  bool success = 2;
}

message UpdateLocationRequest {
  string tracking_number = 1;
  TrackingEventType event_type = 2;
  Location location = 3;
  string description = 4;
  string facility_name = 5;
}

message UpdateLocationResponse {
  TrackingEvent event = 1;
}

message GetTrackingHistoryRequest {
  string tracking_number = 1;
}

message GetTrackingHistoryResponse {
  string tracking_number = 1;
  repeated TrackingEvent events = 2;
  string current_status = 3;
  Location current_location = 4;
}

message SubscribeToUpdatesRequest {
  string tracking_number = 1;
}

message TrackingUpdate {
  TrackingEvent event = 1;
}

message GetCurrentStatusRequest {
  string tracking_number = 1;
}

message GetCurrentStatusResponse {
  string tracking_number = 1;
  TrackingEventType current_status = 2;
  Location current_location = 3;
  google.protobuf.Timestamp last_update = 4;
  google.protobuf.Timestamp estimated_delivery = 5;
}

