syntax = "proto3";

package driver.v1;

option go_package = "github.com/titan-commerce/backend/driver-service/proto/driver/v1;driverpb";

import "google/protobuf/timestamp.proto";

service DriverService {
  // Driver management
  rpc RegisterDriver(RegisterDriverRequest) returns (RegisterDriverResponse);
  rpc GetDriver(GetDriverRequest) returns (GetDriverResponse);
  rpc UpdateDriverStatus(UpdateDriverStatusRequest) returns (UpdateDriverStatusResponse);
  rpc UpdateDriverLocation(UpdateDriverLocationRequest) returns (UpdateDriverLocationResponse);
  rpc GetAvailableDrivers(GetAvailableDriversRequest) returns (GetAvailableDriversResponse);

  // Delivery management
  rpc CreateDelivery(CreateDeliveryRequest) returns (CreateDeliveryResponse);
  rpc AssignRoute(AssignRouteRequest) returns (AssignRouteResponse);
  rpc StartRoute(StartRouteRequest) returns (StartRouteResponse);
  rpc UpdateDeliveryStatus(UpdateDeliveryStatusRequest) returns (UpdateDeliveryStatusResponse);
  rpc RecordProofOfDelivery(RecordProofOfDeliveryRequest) returns (RecordProofOfDeliveryResponse);

  // Queries
  rpc GetDriverRoute(GetDriverRouteRequest) returns (GetDriverRouteResponse);
  rpc GetDeliveryStatus(GetDeliveryStatusRequest) returns (GetDeliveryStatusResponse);
  rpc GetRouteDeliveries(GetRouteDeliveriesRequest) returns (GetRouteDeliveriesResponse);
}

// Enums
enum DriverStatus {
  DRIVER_STATUS_UNSPECIFIED = 0;
  DRIVER_STATUS_AVAILABLE = 1;
  DRIVER_STATUS_ON_DELIVERY = 2;
  DRIVER_STATUS_ON_BREAK = 3;
  DRIVER_STATUS_OFF_DUTY = 4;
}

enum VehicleType {
  VEHICLE_TYPE_UNSPECIFIED = 0;
  VEHICLE_TYPE_MOTORCYCLE = 1;
  VEHICLE_TYPE_CAR = 2;
  VEHICLE_TYPE_VAN = 3;
  VEHICLE_TYPE_TRUCK = 4;
}

enum DeliveryStatus {
  DELIVERY_STATUS_UNSPECIFIED = 0;
  DELIVERY_STATUS_PENDING = 1;
  DELIVERY_STATUS_ASSIGNED = 2;
  DELIVERY_STATUS_IN_TRANSIT = 3;
  DELIVERY_STATUS_AT_LOCATION = 4;
  DELIVERY_STATUS_COMPLETED = 5;
  DELIVERY_STATUS_FAILED = 6;
  DELIVERY_STATUS_RESCHEDULED = 7;
}

enum RouteStatus {
  ROUTE_STATUS_UNSPECIFIED = 0;
  ROUTE_STATUS_CREATED = 1;
  ROUTE_STATUS_ASSIGNED = 2;
  ROUTE_STATUS_IN_PROGRESS = 3;
  ROUTE_STATUS_COMPLETED = 4;
}

// Messages
message Driver {
  string driver_id = 1;
  string name = 2;
  string phone = 3;
  string email = 4;
  VehicleType vehicle_type = 5;
  string license_plate = 6;
  DriverStatus status = 7;
  double current_lat = 8;
  double current_lng = 9;
  double rating = 10;
  int32 total_deliveries = 11;
  int32 successful_deliveries = 12;
  google.protobuf.Timestamp created_at = 13;
  google.protobuf.Timestamp updated_at = 14;
}

message Delivery {
  string delivery_id = 1;
  string shipment_id = 2;
  string route_id = 3;
  string driver_id = 4;
  string customer_name = 5;
  string customer_phone = 6;
  string delivery_address = 7;
  double delivery_lat = 8;
  double delivery_lng = 9;
  DeliveryStatus status = 10;
  int32 sequence_number = 11;
  google.protobuf.Timestamp estimated_arrival = 12;
  google.protobuf.Timestamp actual_arrival = 13;
  ProofOfDelivery proof_of_delivery = 14;
  string notes = 15;
  google.protobuf.Timestamp created_at = 16;
  google.protobuf.Timestamp updated_at = 17;
}

message ProofOfDelivery {
  string photo_url = 1;
  string signature_url = 2;
  string recipient_name = 3;
  google.protobuf.Timestamp completed_at = 4;
}

message DeliveryRoute {
  string route_id = 1;
  string driver_id = 2;
  RouteStatus status = 3;
  int32 total_deliveries = 4;
  int32 completed_deliveries = 5;
  int32 estimated_duration = 6;
  int32 actual_duration = 7;
  google.protobuf.Timestamp started_at = 8;
  google.protobuf.Timestamp completed_at = 9;
  google.protobuf.Timestamp created_at = 10;
  google.protobuf.Timestamp updated_at = 11;
}

// Request/Response messages
message RegisterDriverRequest {
  string name = 1;
  string phone = 2;
  string email = 3;
  VehicleType vehicle_type = 4;
  string license_plate = 5;
}

message RegisterDriverResponse {
  Driver driver = 1;
}

message GetDriverRequest {
  string driver_id = 1;
}

message GetDriverResponse {
  Driver driver = 1;
}

message UpdateDriverStatusRequest {
  string driver_id = 1;
  DriverStatus status = 2;
}

message UpdateDriverStatusResponse {
  bool success = 1;
}

message UpdateDriverLocationRequest {
  string driver_id = 1;
  double latitude = 2;
  double longitude = 3;
}

message UpdateDriverLocationResponse {
  bool success = 1;
}

message GetAvailableDriversRequest {
  double latitude = 1;
  double longitude = 2;
  int32 radius_km = 3;
}

message GetAvailableDriversResponse {
  repeated Driver drivers = 1;
}

message CreateDeliveryRequest {
  string shipment_id = 1;
  string customer_name = 2;
  string customer_phone = 3;
  string delivery_address = 4;
  double latitude = 5;
  double longitude = 6;
}

message CreateDeliveryResponse {
  Delivery delivery = 1;
}

message AssignRouteRequest {
  string driver_id = 1;
  repeated string delivery_ids = 2;
}

message AssignRouteResponse {
  DeliveryRoute route = 1;
}

message StartRouteRequest {
  string route_id = 1;
}

message StartRouteResponse {
  bool success = 1;
}

message UpdateDeliveryStatusRequest {
  string delivery_id = 1;
  DeliveryStatus status = 2;
}

message UpdateDeliveryStatusResponse {
  bool success = 1;
}

message RecordProofOfDeliveryRequest {
  string delivery_id = 1;
  string photo_url = 2;
  string signature_url = 3;
  string recipient_name = 4;
}

message RecordProofOfDeliveryResponse {
  bool success = 1;
}

message GetDriverRouteRequest {
  string driver_id = 1;
}

message GetDriverRouteResponse {
  DeliveryRoute route = 1;
}

message GetDeliveryStatusRequest {
  string delivery_id = 1;
}

message GetDeliveryStatusResponse {
  Delivery delivery = 1;
}

message GetRouteDeliveriesRequest {
  string route_id = 1;
}

message GetRouteDeliveriesResponse {
  repeated Delivery deliveries = 1;
}

