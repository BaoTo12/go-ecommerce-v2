syntax = "proto3";

package review.v1;

option go_package = "github.com/titan-commerce/backend/review-service/proto/review/v1;reviewv1";

import "google/protobuf/timestamp.proto";

service ReviewService {
  rpc CreateReview(CreateReviewRequest) returns (CreateReviewResponse);
  rpc GetProductReviews(GetProductReviewsRequest) returns (GetProductReviewsResponse);
  rpc GetReviewStats(GetReviewStatsRequest) returns (GetReviewStatsResponse);
}

message CreateReviewRequest {
  string user_id = 1;
  string product_id = 2;
  int32 rating = 3; // 1-5
  string comment = 4;
  repeated string images = 5;
}

message CreateReviewResponse {
  string review_id = 1;
  Review review = 2;
}

message GetProductReviewsRequest {
  string product_id = 1;
  int32 page = 2;
  int32 page_size = 3;
}

message GetProductReviewsResponse {
  repeated Review reviews = 1;
  int32 total = 2;
}

message GetReviewStatsRequest {
  string product_id = 1;
}

message GetReviewStatsResponse {
  double average_rating = 1;
  int32 total_reviews = 2;
  map<int32, int32> rating_distribution = 3; // e.g. 5 stars -> 100, 4 stars -> 50
}

message Review {
  string id = 1;
  string user_id = 2;
  string product_id = 3;
  int32 rating = 4;
  string comment = 5;
  repeated string images = 6;
  google.protobuf.Timestamp created_at = 7;
}
