syntax = "proto3";

package review.v1;

option go_package = "github.com/titan-commerce/backend/review-service/proto/review/v1;reviewv1";

import "google/protobuf/timestamp.proto";

service ReviewService {
  rpc CreateReview(CreateReviewRequest) returns (CreateReviewResponse);
  rpc GetReviews(GetReviewsRequest) returns (GetReviewsResponse);
  rpc VoteReview(VoteReviewRequest) returns (VoteReviewResponse);
  rpc FlagReview(FlagReviewRequest) returns (FlagReviewResponse);
}

message Review {
  string review_id = 1;
  string product_id = 2;
  string user_id = 3;
  string user_name = 4;
  int32 rating = 5;  // 1-5 stars
  string title = 6;
  string content = 7;
  repeated string image_urls = 8;
  int32 helpful_count = 9;
  bool verified_purchase = 10;
  google.protobuf.Timestamp created_at = 11;
}

message CreateReviewRequest {
  string product_id = 1;
  string user_id = 2;
  string order_id = 3;  // To verify purchase
  int32 rating = 4;
  string title = 5;
  string content = 6;
  repeated string image_urls = 7;
}

message CreateReviewResponse {
  Review review = 1;
}

message GetReviewsRequest {
  string product_id = 1;
  int32 page = 2;
  int32 page_size = 3;
  int32 min_rating = 4;
}

message GetReviewsResponse {
  repeated Review reviews = 1;
  int32 total_count = 2;
  double average_rating = 3;
}

message VoteReviewRequest {
  string review_id = 1;
  string user_id = 2;
  bool helpful = 3;
}

message VoteReviewResponse {
  bool success = 1;
}

message FlagReviewRequest {
  string review_id = 1;
  string user_id = 2;
  string reason = 3;
}

message FlagReviewResponse {
  bool success = 1;
}
